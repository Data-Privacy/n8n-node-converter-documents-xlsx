# Анализ задач по проекту n8n-node-converter-documents

## Важно: ограничения и проблемы с PDF, XLS, XLSX

- **Потоковая обработка PDF невозможна** с использованием текущей библиотеки [`pdf-parse`]. Библиотека загружает весь файл в память, что может привести к высокой нагрузке на ОЗУ и сбоям при обработке больших PDF-файлов.
- **XLS/XLSX:** библиотека [`xlsx`] (SheetJS) также загружает весь файл в память при чтении. Для очень больших файлов (сотни тысяч строк, десятки мегабайт и более) возможны сбои, зависания и превышение лимита памяти. Потоковая обработка чтения не поддерживается. Рекомендуется разбивать файлы или использовать специализированные инструменты.
- **Рекомендация:** для работы с большими файлами используйте предварительную обработку или сторонние инструменты.

## Выполненные задачи

- Вынесены вспомогательные функции в отдельный файл helpers.ts
- Исходный код организован в папку src/
- Описание структуры проекта добавлено в README.md
- Установлен и настроен линтер (ESLint) для TypeScript
- Добавлен prettier для автоформатирования
- Сообщения об ошибках приведены к единому стилю
- Создана папка test/ и добавлен README для структуры тестов
- Добавлены примеры входных и выходных данных в README.md
- Описаны ограничения и возможные ошибки в README.md
- Проект полностью переведён на TypeScript:
  - tsconfig.json создан и настроен
  - исходные файлы перенесены и переименованы в .ts
  - импорты/экспорты исправлены под CommonJS, сборка через tsc
  - добавлены типы для функций, классов и переменных
  - установлены типы для зависимостей
  - обновлён конфиг ESLint для поддержки TypeScript
  - добавлен скрипт сборки (npm run build)
  - обновлены инструкции в README.md для работы с TypeScript-версией
- ✅ Реализована асинхронная обработка нескольких файлов с ограничением по количеству потоков (Promise pool, параметр maxConcurrency)
- ✅ Внедрён паттерн "стратегий" для обработки форматов (каждый формат — отдельная функция, реестр стратегий)
- ✅ Добавлена возможность легко подключать новые форматы (достаточно добавить функцию и зарегистрировать её в strategies)

## Приоритеты и оставшиеся задачи

### 1. [КРИТИЧНО] Проверка и защита входных данных
- Добавить строгую валидацию типов, структуры и размера входных данных до начала обработки.
- Обеспечить защиту от некорректных/вредоносных файлов.

### 2. [КРИТИЧНО] Безопасность при работе с HTML и другими форматами
- Использовать безопасные методы парсинга HTML (например, sanitize-html для очистки).
- Проверять входные данные на наличие вредоносных скриптов и XSS.

### 3. [ВЫСОКИЙ] Оптимизация работы с большими файлами (кроме PDF, XLS, XLSX)
- Для CSV и TXT уже внедрена потоковая обработка.
- Проверить, поддерживают ли используемые библиотеки потоковую обработку для других форматов (например, XML, DOCX).
- Если возможно — внедрить потоковую обработку.
- Для XLS/XLSX и PDF добавить явные предупреждения в документацию и UI (см. выше).

### 4. [ВЫСОКИЙ] Добавить юнит-тесты для основных функций
- Настроить Jest или другой тестовый фреймворк.
- Написать тесты для helpers и стратегий обработки форматов.

### 5. [СРЕДНИЙ] Использовать собственные классы ошибок для разных типов ошибок
- Убедиться, что все ошибки обрабатываются через кастомные классы (`FileTypeError`, `FileTooLargeError`, `UnsupportedFormatError`, и т.д.).
- Привести обработку ошибок к единому стилю.

---

**Примечание:** выполнение задач с высоким приоритетом существенно повысит надёжность, безопасность и производительность проекта. Критичные задачи рекомендуется реализовать в первую очередь.
