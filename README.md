# n8n-node-converter-documents

## Описание

Этот проект представляет собой кастомный нод для n8n, предназначенный для конвертации различных файловых форматов в JSON или текстовый вид. Поддерживаются следующие форматы: DOC, DOCX, XML, XLS, XLSX, CSV, PDF, TXT, PPT, PPTX, HTML/HTM.

## Возможности

- Автоматическое определение типа файла по расширению или содержимому
- Извлечение текста или таблиц из популярных офисных и текстовых форматов
- Выходные данные: `{ text: "..." }` или `{ sheets: {...} }` + метаданные (имя, размер, тип файла, время обработки)
- Обработка больших файлов (до 50 МБ)
- Сообщения о пустых или неподдерживаемых файлах

## Используемые библиотеки

- **xml2js** — для разбора XML
- **mammoth** — для извлечения текста из DOCX
- **textract** — для DOC, PPT, PPTX
- **xlsx** — для XLS, XLSX, CSV
- **pdf-parse** — для PDF
- **cheerio** — для HTML/HTM
- **file-type** — для определения типа файла по содержимому
- **chardet** + **iconv-lite** — для определения и декодирования кодировки TXT

## Примеры входных и выходных данных

**Вход:**

- Бинарный файл (например, DOCX, PDF, XLSX и др.) в поле `data`.

**Выход:**

- Для текстовых форматов:

```json
{
  "text": "Извлечённый текст...",
  "metadata": {
    "fileName": "example.docx",
    "fileSize": 12345,
    "fileType": "docx",
    "processedAt": "2024-06-01T12:00:00.000Z"
  }
}
```

- Для табличных форматов:

```json
{
  "sheets": {
    "Sheet1": [ { "A": "Значение1", "B": "Значение2" }, ... ]
  },
  "metadata": {
    "fileName": "example.xlsx",
    "fileSize": 23456,
    "fileType": "xlsx",
    "processedAt": "2024-06-01T12:00:00.000Z"
  }
}
```

## Структура проекта

- `src/` — папка для исходного кода (рекомендуется для расширения)
- `helpers.js` — вспомогательные функции
- `FileToJsonNode.node.js` — основной файл с логикой нода
- `test/` — папка для тестовых файлов и юнит-тестов
- `package.json` — файл зависимостей и скриптов

## Установка зависимостей

Все необходимые зависимости уже установлены через npm:

```
npm install xml2js mammoth textract xlsx pdf-parse cheerio file-type chardet iconv-lite
```

## Рекомендации

- Для добавления новых форматов потребуется добавить соответствующую библиотеку и обработчик в основной файл.
- Для интеграции в n8n убедитесь, что нод корректно подключён к вашей системе.

## Сборка и использование с TypeScript

1. Для сборки проекта выполните:
   ```
   npm run build
   ```
   Итоговые файлы появятся в папке `dist/`.
2. Для использования кастомного нода в n8n укажите путь к `dist/FileToJsonNode.node.js`.
3. Основной файл для n8n теперь: `dist/FileToJsonNode.node.js` (см. поле `main` в package.json).

---

Если потребуется документация по какому-либо модулю или помощь с интеграцией — обращайтесь!
